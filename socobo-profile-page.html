<link rel="import" href="elements.html">
<!--
The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--socobo-profile-page-profile-container` | Styling the Profile Container that holds the Image and the Information. | `{}`
`--socobo-profile-page-profile-image-container` | Styling the Image Holder Container | `{}`
`--socobo-profile-page-profile-image-container-bg-color-from` | Styling the Gradient Color for the Background - From | `{#04212A}`
`--socobo-profile-page-profile-image-container-bg-color-to` | Styling the Gradient Color for the Background - To | `{#062f3c}`
`--socobo-profile-page-profile-info-container` | Styling the Information Holder Container | `{}`

@demo demo/index.html
-->
<dom-module id="socobo-profile-page">
  <template>
    <style>
      :host {
        display: block;
      }
      .profile-container {
        @apply(--layout-horizontal);
        width: 100%;
        height: 100%;
        @apply(--socobo-profile-page-profile-container);
      }
      .profile-image-container {
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        width: 20%;
        height: 900px; /*100%;*/
        margin: 0;
        background: -webkit-linear-gradient(var(--socobo-profile-page-profile-image-container-bg-color-from, #04212A),var(--socobo-profile-page-profile-image-container-bg-color-to, #062f3c));
        background: -o-linear-gradient(var(--socobo-profile-page-profile-image-container-bg-color-from, #04212A),var(--socobo-profile-page-profile-image-container-bg-color-to, #062f3c));
        background: -moz-linear-gradient(var(--socobo-profile-page-profile-image-container-bg-color-from, #04212A),var(--socobo-profile-page-profile-image-container-bg-color-to, #062f3c));
        background: linear-gradient(var(--socobo-profile-page-profile-image-container-bg-color-from, #04212A),var(--socobo-profile-page-profile-image-container-bg-color-to, #062f3c));
        @apply(--socobo-profile-page-profile-image-container);
      }
      .profile-info-container {
        @apply(--layout-vertical);
        width: 80%;
        height: 100%;
        margin: 0;
        @apply(--socobo-profile-page-profile-info-container);
      }
    </style>

    <div class="profile-container">
      <div class="profile-image-container">
        <socobo-profile-image
          id="profileImage"
          image-source="{{profileObject.profileImage}}"
          on-profile-image-changed="_handleProfileImageChanged">
        </socobo-profile-image>
      </div>

      <div class="profile-info-container">
        <socobo-profile-info
          id="profileInfo"
          profile-object="{{profileObject}}"
          on-save-info-standard="_handleSaveInfoStandard"
          on-save-info-biography="_handleSaveInfoBiography"
          on-change-email-address="_handleChangeEmailAddress"
          on-change-password="_handleChangePassword"
          on-reset-password="_handleResetPassword"
          on-delete-account="_handleDeleteAccount"
          on-passwords-not-matching="_handlePasswordsNotMatching">
        </socobo-profile-info>
      </div>
    </div>

    <paper-toast id="infoToast" duration="2000"></paper-toast>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'socobo-profile-page',

        /**
         * Element Properties.
         */
        properties: {
          /**
           * User Login Object
           */
          userLogin: {
            type: Object,
            value: {},
            notify: true
          },
          /**
           * User Information Object
           */
          profileObject: {
            type: Object,
            value: {},
            notify: true
          }
        },

        /**
         * PROFILE IMAGE
         */
        /**
         * Show Toast if the Profile Image is changed. <br/>
         * @param {Object} e Message
         * @private
         * @method _handleProfileImageChanged
         */
        _handleProfileImageChanged: function(e) {
          Util.getInstance(this).showToast(this.$.infoToast, e.detail.value, "#333333", "#EEEEEE");
          this.fire("profile-image-changed", this.profileObject.profileImage);
        },

        /**
         * PROFILE INFO
         */
        /**
         * USER INFO
         */
        _handleSaveInfoStandard: function(e) {
          SocoboProfile
            .getInstance(this.userLogin.firebaseUrl, this.userLogin.userId)
            .updateProfileData(e.detail)
            .then(function(succ) {
              Util.getInstance(this).showToast(this.$.infoToast, succ.value, "#2EB82E", "#EEEEEE");
              this.fire("profile-user-info-changed", e.detail);
            }.bind(this))
            .catch(function(err) {
              Util.getInstance(this).showToast(this.$.infoToast, err.message, "#FF3333", "#EEEEEE");
            }.bind(this));
        },

        /**
         * USER BIOGRAPHY
         */
        _handleSaveInfoBiography: function(e) {
          SocoboProfile
            .getInstance(this.userLogin.firebaseUrl, this.userLogin.userId)
            .updateProfileData(e.detail)
            .then(function(succ) {
              Util.getInstance(this).showToast(this.$.infoToast, succ.value, "#2EB82E", "#EEEEEE");
            }.bind(this))
            .catch(function(err) {
              Util.getInstance(this).showToast(this.$.infoToast, err.message, "#FF3333", "#EEEEEE");
            }.bind(this));
        },

        /**
         * ADMINISTRATION
         */
        /**
         *
         * @param e
         * @private
         * @method _handleChangeEmailAddress
         */
        _handleChangeEmailAddress: function(e){
          SocoboProfile
            .getInstance(this.userLogin.firebaseUrl, this.userLogin.userId)
            .changeUserEmailAddress(e.detail)
            .then(function(succ) {
              Util.getInstance(this).showToast(this.$.infoToast, succ.value, "#2EB82E", "#EEEEEE");
            }.bind(this))
            .catch(function(err) {
              Util.getInstance(this).showToast(this.$.infoToast, err.value, "#FF3333", "#EEEEEE");
            }.bind(this));
        },
        /**
         *
         * @param {Object} e
         * @private
         * @method _handleChangePassword
         */
        _handleChangePassword: function(e) {
          SocoboProfile
            .getInstance(this.userLogin.firebaseUrl, this.userLogin.userId)
            .changeUserPassword(e.detail)
            .then(function(succ) {
              Util.getInstance(this).showToast(this.$.infoToast, succ.value, "#2EB82E", "#EEEEEE");
            }.bind(this))
            .catch(function(err) {
              Util.getInstance(this).showToast(this.$.infoToast, err.value, "#FF3333", "#EEEEEE");
            }.bind(this));
        },
        /**
         *
         * @param {Object} e
         * @private
         * @method _handleResetPassword
         */
        _handleResetPassword: function(e) {
          SocoboProfile
            .getInstance(this.userLogin.firebaseUrl, this.userLogin.userId)
            .resetUserPassword(e.detail)
            .then(function(succ) {
              Util.getInstance(this).showToast(this.$.infoToast, succ.value, "#2EB82E", "#EEEEEE");
            }.bind(this))
            .catch(function(err) {
              Util.getInstance(this).showToast(this.$.infoToast, err.value, "#FF3333", "#EEEEEE");
            }.bind(this));
        },
        /**
         *
         * @param {Object} e
         * @private
         * @method _handleDeleteAccount
         */
        _handleDeleteAccount: function(e) {
          // ToDo: Add Confirm Dialog
          SocoboProfile
            .getInstance(this.userLogin.firebaseUrl, this.userLogin.userId)
            .removeUserAccount(e.detail)
            .then(function(succ) {
              Util.getInstance(this).showToast(this.$.infoToast, succ.value, "#2EB82E", "#EEEEEE");
              this.fire("account-deleted");
            }.bind(this))
            .catch(function(err) {
              Util.getInstance(this).showToast(this.$.infoToast, err.value, "#FF3333", "#EEEEEE");
            }.bind(this));
        },
        /**
         * Show Toast if the Passwords not matching. <br/>
         * @param {Object} e Message
         * @private
         * @method _handlePasswordsNotMatching
         */
        _handlePasswordsNotMatching: function(e) {
          Util.getInstance(this).showToast(this.$.infoToast, e.detail.value, "#FF3333", "#EEEEEE");
        }
      });
    })();
  </script>
</dom-module>
