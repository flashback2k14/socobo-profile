<dom-module id="socobo-profile-info">
  <style>
    :host {
      display: block;
    }
    .profile-info-container {
      @apply(--layout-vertical);
    }
    .style-paper-card {
      --paper-card-header: {
        background: #062f3c;
      };
      --paper-card-header-text: {
        margin-left: 20px;
        font-size: 35px;
        color: #fff;
      };
      --paper-card-content: {
         font-size: 20px;
      };
    }
    .paper-card-height-normal {
      height: 230px;
    }
    .paper-card-height-large {
      height: 400px;
    }
    /*USER INFO*/
    .profile-info-standard {
      @apply(--layout-vertical);
      margin: 0 20px;
    }
    .style-fab-edit-info-standard {
      position: absolute !important;
      top: 48px;
      right: 48px;
    }
    .show-info {
      display: block;
      margin-top: -15px;
    }
    .edit-info {
      display: none;
    }
    .vertical-line {
      @apply(--layout-vertical);
      margin: 10px 20px 5px 20px;
    }
    .style-el-info {
      margin-top: 5px;
    }
    .bottom-right-align {
      position: absolute !important;
      right: 30px;
      bottom: 30px;
    }
    .style-save-button {
      --paper-button: {
        background: var(--paper-green-500);
        color: #ffffff;
        font-size: medium;
      };
    }
    /*USER BIOGRAPHY*/
    .profile-info-biography {
      @apply(--layout-vertical);
      margin: 20px 20px;
    }
    .style-fab-edit-info-biography {
      position: absolute !important;
      top: 48px;
      right: 48px;
    }
    .style-label-user-biography {
      min-height: 50px;
      height: 50px;
      max-height: 50px;
      overflow: auto;
    }
    .width-for-inputs {
      width: 80%;
    }
    /*USER ADMINISTRATION*/
    .profile-info-admin {
      @apply(--layout-vertical);
      margin: 0 20px;
    }
    .main-admin-container {
      @apply(--layout-horizontal);
    }
    .left-admin-container {
      @apply(--layout-vertical);
      width: 25%;
      margin: 30px 10px 0 15px;
    }
    .style-admin-buttons {
      --paper-button: {
        background: var(--paper-indigo-700);
        color: #ffffff;
        font-size: medium;
        margin-bottom: 15px;
      };
    }
    .right-admin-container {
      @apply(--layout-vertical);
      width: 75%;
      margin: 30px 10px 0 30px;
    }
    .show-right-admin-container {
      display: block;
    }
    .hide-right-admin-container {
      display: none;
    }
    .style-admin-inputs {
      width: 70%;
      margin-bottom: 15px;
    }
    .btn-submit-container {
      @apply(--layout-horizontal);
      @apply(--layout-end-justified);
      width: 70%;
    }
  </style>

  <template>
    <div class="profile-info-container">
      <!-- Information Section -->
      <div class="profile-info-standard">
        <paper-card class="style-paper-card paper-card-height-normal" heading="Information" elevation="3">
          <paper-fab id="fabEditInfoStandard" class="style-fab-edit-info-standard" icon="create" on-tap="_editInfoStandard"></paper-fab>
          <div class="card-content">
            <div id="showInfoStandard" class="show-info">
              <div class="vertical-line">
                <label for="elUsername"><strong>Username</strong></label>
                <span id="elUsername" class="style-el-info width-for-inputs">{{userObject.Username}}</span>
              </div>
              <div class="vertical-line">
                <label for="elEmailAddress"><strong>Email-Address</strong></label>
                <span id="elEmailAddress" class="style-el-info width-for-inputs">{{userObject.EmailAddress}}</span>
              </div>
            </div>
            <div id="editInfoStandard" class="edit-info">
              <div class="vertical-line">
                <label for="elUsername"><strong>Username</strong></label>
                <paper-input id="txtUsername" class="width-for-inputs" label="Username" type="text" value="{{userObject.Username}}" no-label-float="true"></paper-input>
              </div>
              <div class="vertical-line">
                <label for="elEmailAddress"><strong>Email-Address</strong></label>
                <paper-input id="txtEmailAddress" class="width-for-inputs" label="Username" type="email" value="{{userObject.EmailAddress}}" no-label-float="true"></paper-input>
              </div>
              <div class="bottom-right-align">
                <paper-button id="btnSaveInfoStandard" class="style-save-button" on-tap="_saveInfoStandard" raised>Save</paper-button>
              </div>
            </div>
          </div>
        </paper-card>
      </div>
      <!-- Biography Section -->
      <div class="profile-info-biography">
        <paper-card class="style-paper-card paper-card-height-normal" heading="Biography" elevation="3">
          <paper-fab id="fabEditInfoBiography" class="style-fab-edit-info-biography" icon="create" on-tap="_editInfoBiography"></paper-fab>
          <div class="card-content">
            <div id="showInfoBio" class="show-info">
              <div class="vertical-line">
                <span id="lblUserBiography" class="style-label-user-biography width-for-inputs">{{userObject.Biography}}</span>
              </div>
            </div>
            <div id="editInfoBio" class="edit-info">
              <div class="vertical-line">
                <paper-textarea id="txtBiography" class="width-for-inputs" rows="5" max-rows="4" value="{{userObject.Biography}}" placeholder="Please tell us something about you!" no-label-float="true"></paper-textarea>
              </div>
              <div class="bottom-right-align">
                <paper-button id="btnSaveInfoBiography" class="style-save-button" on-tap="_saveInfoBiography" raised>Save</paper-button>
              </div>
            </div>
          </div>
        </paper-card>
      </div>
      <!-- Administration Section -->
      <template is="dom-if" if="{{_checkUserLoginProvider(userObject)}}">
        <div class="profile-info-admin">
          <paper-card class="style-paper-card paper-card-height-large" heading="Adminstration" elevation="3">
            <div class="card-content">
              <div class="main-admin-container">
                <div class="left-admin-container">
                  <paper-button id="btnChangeEmailAddress" class="style-admin-buttons" on-tap="_changeEmailAddress">Change Email Address</paper-button>
                  <paper-button id="btnChangePassword" class="style-admin-buttons" on-tap="_changePassword">Change Password</paper-button>
                  <paper-button id="btnResetPassword" class="style-admin-buttons" on-tap="_resetPassword">Reset Password</paper-button>
                  <paper-button id="btnDeleteAccount" class="style-admin-buttons" on-tap="_deleteAccount">Delete Account</paper-button>
                </div>
                <div class="right-admin-container">
                  <div id="rightAdminContainer" class="hide-right-admin-container">
                    <paper-input id="txtOldEmailAddress" class="style-admin-inputs hide-right-admin-container" label="Old Emailaddress" type="email" no-label-float="true"></paper-input>
                    <paper-input id="txtNewEmailAddress" class="style-admin-inputs hide-right-admin-container" label="New Emailaddress" type="email" no-label-float="true"></paper-input>
                    <paper-input id="txtOldPassword" class="style-admin-inputs hide-right-admin-container" label="Old Password" type="password" no-label-float="true"></paper-input>
                    <paper-input id="txtNewPassword" class="style-admin-inputs hide-right-admin-container" label="New Password" type="password" no-label-float="true"></paper-input>
                    <div class="btn-submit-container">
                      <paper-button id="btnSubmitAdminChanges" class="style-save-button" on-tap="_submitAdminChanges" raised>Submit</paper-button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </paper-card>
        </div>
      </template>

      </div>
    </div>
  </template>
</dom-module>

<script>
  (function() {
    Polymer({
      is: 'socobo-profile-info',
      /**
       * Element Properties
       */
      properties: {
        /**
         * User Object
         */
        userObject: {
          type: Object,
          value: {},
          notify: true
        }
      },

      /**
       * Variable to manage Admin Section State
       * @private
       */
      _adminSection: "",
      /**
       * Variable to hold changed Input Field Values
       * @private
       */
      _changeValues: {},

      /**
       * Function for Show / Hide Edit Information Section
       * @param e FAB
       * @private
       */
      _editInfoStandard: function(e) {
        this._toggleInformationArea(e);
      },
      /**
       * Function for Show / Hide Edit Biography Section
       * @param e FAB
       * @private
       */
      _editInfoBiography: function(e) {
        this._toggleInformationArea(e);
      },
      /**
       * Function for Fire Event to Save Information changes.
       * @private
       */
      _saveInfoStandard: function() {
        var obj = {
          usernameValue: this.$.txtUsername.value,
          emailAddressValue: this.$.txtEmailAddress.value
        };
        this.fire("save-info-standard", obj);
      },
      /**
       * Function for Fire Event to Save Biography changes.
       * @private
       */
      _saveInfoBiography: function() {
        this.fire("save-info-biography", {bioValue: this.$.txtBiography.value});
      },
      /**
       * Function for show Admin section only if the user is logged in with emailaddress.
       * @param obj User Object
       * @private
       */
      _checkUserLoginProvider: function(obj) {
        if (typeof obj !== 'undefined') {
          return obj.provider === "password";
        }
      },
      /**
       * Toggle Change Email Address Section
       * @param e Button
       * @private
       */
      _changeEmailAddress: function(e) {
        this._toggleRightAdminContainerElements(e);
      },
      /**
       * Toggle Change Password
       * @param e Button
       * @private
       */
      _changePassword: function(e) {
        this._toggleRightAdminContainerElements(e);
      },
      /**
       * Toggle Reset Password Section
       * @param e Button
       * @private
       */
      _resetPassword: function(e) {
        this._toggleRightAdminContainerElements(e);
      },
      /**
       * Toggle Delete Account Section
       * @param e Button
       * @private
       */
      _deleteAccount: function(e) {
        this._toggleRightAdminContainerElements(e);
      },

      /**
       * Function to submit changes
       * @param e Button
       * @private
       */
      _submitAdminChanges: function(e) {
        var txtOldEmailAddress = document.querySelector("#txtOldEmailAddress").value;
        var txtNewEmailAddress = document.querySelector("#txtNewEmailAddress").value;
        var txtOldPassword = document.querySelector("#txtOldPassword").value;
        var txtNewPassword = document.querySelector("#txtNewPassword").value;

        switch (this._adminSection) {
          case "ChangeEmailAddress":
            this._changeValues = {
              type: "ChangeEmailAddress",
              oldMail: txtOldEmailAddress,
              newMail: txtNewEmailAddress,
              oldPwd: txtOldPassword
            };
            txtOldEmailAddress.value = "";
            txtNewEmailAddress.value = "";
            txtOldPassword.value = "";
            this.fire("change-email-address", this._changeValues);
            break;
          case "ChangePassword":
            this._changeValues = {
              type: "ChangePassword",
              oldMail: txtOldEmailAddress,
              oldPwd: txtOldPassword,
              newPwd: txtNewPassword
            };
            txtOldEmailAddress.value = "";
            txtOldPassword.value = "";
            txtNewPassword.value = "";
            this.fire("change-password", this._changeValues);
            break;
          case "ResetPassword":
            this._changeValues = {
              type: "ResetPassword",
              oldMail: txtOldEmailAddress
            };
            txtOldEmailAddress.value = "";
            this.fire("reset-password", this._changeValues);
            break;
          case "DeleteAccount":
            this._changeValues = {
              type: "DeleteAccount",
              oldMail: txtOldEmailAddress,
              oldPwd: txtOldPassword
            };
            txtOldEmailAddress.value = "";
            txtOldPassword.value = "";
            this.fire("delete-account", this._changeValues);
            break;
          default:
            alert("no valid operation chosen!");
        }

        this._toggleRightAdminContainerElements(e);
      },

      /**
       * HELPER FUNCTIONS PROFILE SECTION
       */
      /**
       * Toggle specific Profile Section to Edit or Show Information
       * @param e FAB
       * @private
       */
      _toggleInformationArea: function(e) {
        if (e.currentTarget.id === "fabEditInfoStandard") {
          this._toggleInformationItem(this.$.showInfoStandard, "show-info", "edit-info");
          this._toggleInformationItem(this.$.editInfoStandard, "show-info", "edit-info");
        } else {
          this._toggleInformationItem(this.$.showInfoBio, "show-info", "edit-info");
          this._toggleInformationItem(this.$.editInfoBio, "show-info", "edit-info");
        }
      },
      /**
       * Toggle specific Profile Section
       * @param element Info Container
       * @param showCssClass CSS Class to show an Element
       * @param hideCssClass CSS Class to hide an Element
       * @private
       */
      _toggleInformationItem: function(element, showCssClass, hideCssClass) {
        if (element.classList.contains(showCssClass)) {
          this._hideElement(element, showCssClass, hideCssClass);
        } else {
          this._showElement(element, showCssClass, hideCssClass);
        }
      },

      /**
       * HELPER FUNCTIONS ADMINISTRATION SECTION
       */
      /**
       * Toggle right Admin Container to show specific Input Fields
       * @param e Button
       * @private
       */
      _toggleRightAdminContainerElements: function(e) {
        var container = document.querySelector("#rightAdminContainer");
        var iOldEmailAddress = document.querySelector("#txtOldEmailAddress");
        var iNewEmailAddress = document.querySelector("#txtNewEmailAddress");
        var iOldPassword = document.querySelector("#txtOldPassword");
        var iNewPassword = document.querySelector("#txtNewPassword");
        var button = e.currentTarget.id;

        if (container.classList.contains("hide-right-admin-container")) {
          this._showElement(container, "show-right-admin-container", "hide-right-admin-container");

          switch (button) {
            case "btnChangeEmailAddress":
              if (!this._isElementShown(iOldEmailAddress)) {
                this._showElement(iOldEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (!this._isElementShown(iNewEmailAddress)) {
                this._showElement(iNewEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (!this._isElementShown(iOldPassword)) {
                this._showElement(iOldPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              if (this._isElementShown(iNewPassword)) {
                this._hideElement(iNewPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              this._adminSection = "ChangeEmailAddress";
              break;
            case "btnChangePassword":
              if (!this._isElementShown(iOldEmailAddress)) {
                this._showElement(iOldEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (this._isElementShown(iNewEmailAddress)) {
                this._hideElement(iNewEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (!this._isElementShown(iOldPassword)) {
                this._showElement(iOldPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              if (!this._isElementShown(iNewPassword)) {
                this._showElement(iNewPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              this._adminSection = "ChangePassword";
              break;
            case "btnResetPassword":
              if (!this._isElementShown(iOldEmailAddress)) {
                this._showElement(iOldEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (this._isElementShown(iNewEmailAddress)) {
                this._hideElement(iNewEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (this._isElementShown(iOldPassword)) {
                this._hideElement(iOldPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              if (this._isElementShown(iNewPassword)) {
                this._hideElement(iNewPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              this._adminSection = "ResetPassword";
              break;
            case "btnDeleteAccount":
              if (!this._isElementShown(iOldEmailAddress)) {
                this._showElement(iOldEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (this._isElementShown(iNewEmailAddress)) {
                this._hideElement(iNewEmailAddress, "show-right-admin-container", "hide-right-admin-container");
              }
              if (!this._isElementShown(iOldPassword)) {
                this._showElement(iOldPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              if (this._isElementShown(iNewPassword)) {
                this._hideElement(iNewPassword, "show-right-admin-container", "hide-right-admin-container");
              }
              this._adminSection = "DeleteAccount";
              break;
          }
        } else {
          this._adminSection = "";
          this._changeValues = {};
          this._hideElement(container, "show-right-admin-container", "hide-right-admin-container");
        }
      },
      /**
       * Check if an Element is shown
       * @param element Input Field
       * @return {boolean}
       * @private
       */
      _isElementShown: function(element) {
        return element.classList.contains("show-right-admin-container");
      },
      /**
       * Show an Element
       * @param element Element
       * @param showCssClass CSS Class to show an Element
       * @param hideCssClass CSS Class to hide an Element
       * @private
       */
      _showElement: function(element, showCssClass, hideCssClass) {
        element.classList.remove(hideCssClass);
        element.classList.add(showCssClass);
      },
      /**
       * Hide an Element
       * @param element Element
       * @param showCssClass CSS Class to show an Element
       * @param hideCssClass CSS Class to hide an Element
       * @private
       */
      _hideElement: function(element, showCssClass, hideCssClass) {
        element.classList.remove(showCssClass);
        element.classList.add(hideCssClass);
      }
    });
  })();
</script>
